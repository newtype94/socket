<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>WebSocket test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
    <script type="text/javascript">
      let wSocket;
      let logs;

      const transaction = {
        userId: 123,
        voiceHash: "md5 hash by voice",
        timeStamp: new Date().getTime(),
      };

      let blocks = [
        {
          index: 1,
          hash: "thisblocksHash",
          previousHash: "ItIsPreviousHash",
          timestamp: new Date().getTime(),
          data: "",
        },
        {
          index: 2,
          hash: "thisblocksHash",
          previousHash: "ItIsPreviousHash",
          timestamp: new Date().getTime(),
          data: "",
        },
      ];

      window.onload = () => {
        wSocket = new WebSocket(
          "wss://aopdc2k8sk.execute-api.ap-northeast-2.amazonaws.com/Prod"
        );

        logs = document.getElementById("result");

        wSocket.onopen = onOpen;
        wSocket.onclose = onClose;
        wSocket.onmessage = onMessage;
        wSocket.onerror = onError;
      };

      function onOpen(e) {
        logs.textContent += "opened\n";
      }

      function onClose(e) {
        logs.textContent += "WebSocket closed!\n";
      }

      function onMessage(e) {
        logs.textContent += "메시지 수신 : " + e.data + "\n";
      }

      function onError(e) {
        logs.textContent += "오류발생 : " + e.data + "\n";
      }

      function doOpen() {
        wSocket = new WebSocket(
          "wss://aopdc2k8sk.execute-api.ap-northeast-2.amazonaws.com/Prod"
        );

        wSocket.onopen = onOpen;
        wSocket.onclose = onClose;
        wSocket.onmessage = onMessage;
        wSocket.onerror = onError;
      }

      function doClose() {
        wSocket.close();
      }

      function doSend() {
        transaction.voiceHash = document.getElementById("message").value;
        wSocket.send(
          JSON.stringify({
            message: "sendmessage",
            data: JSON.stringify(blocks),
          })
        );
      }

      function doCheck() {
        wSocket.send(
          JSON.stringify({
            message: "checkhash",
            data: "123123",
          })
        );
      }
    </script>
  </head>
  <body>
    <input type="button" onclick="doOpen();" value="Open" />
    <input type="button" onclick="doClose();" value="Close" />
    <input type="text" placeholder="Message" id="message" />
    <input type="button" onclick="doSend();" value="Send" />
    <input type="button" onclick="doCheck();" value="checkhash" />
    <h3 id="result">로그</h3>
  </body>
</html>
